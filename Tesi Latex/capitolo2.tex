\chapter{Analisi del progetto preesistente}
\thispagestyle{empty}
%\lhead[\fancyplain{}{\bfseries\thepage}]{\fancyplain{}{\bfseries\rightmark}} 

\section{Breve descrizione degli strumenti coinvolti}

\subsection{Monocromatore}
Un monocromatore \`e un dispositivo che scompone un singolo fascio di luce policromatica in pi\`u fasci di luce monocromatica (che contiene cio\`e onde di una sola frequenza), permettendo cos\`i di analizzare l'intensit\`a in funzione della lunghezza d'onda.\\
Nello strumento la luce policromatica entra da una fessura; tramite un sistema ottico viene inviata su un reticolo di diffrazione o ad un prisma che scompone il fascio. Una seconda fenditura raccoglie poi il fascio di una determinata lunghezza d'onda.\\
In questo progetto si considera un monocromatore Jobin-Yvon HR460. La luce che entra dalla fessura viene rifratta (?) due volte attraverso due lenti tra cui \`e interposta una griglia che scompone il fascio di luce. 

\subsection{Fotocamera}
Una fotocamera intensificata \`e una fotocamera che al posto della pellicola fotosensibile utilizza un sensore (CCD) in grado di catturare l'immagine e trasformarla in un segnale elettrico di tipo analogico. Gli impulsi elettrici vengono convertiti in digitale da un convertitore analogico/digitale in un chip di elaborazione esterno al sensore. Viene quindi generato un flusso di dati digitali atti ad essere immagazzinati in vari formati su supporto di memoria.\\
Il CCD (Charged-Coupled Device) \`e un dispositivo attraverso il quale si ottiene un segnale elettrico in uscita, in seguito a una sequenza temporizzata di impulsi, grazie al quale \`e possibile ricostruire la matrice di pixel che compongono l'immagine proiettata sulla superficie del CCD stesso. Questa informazione pu\`o essere usata come segnale analogico, e quindi essere usata per riprodurre l'immagine su un monitor, oppure pu\`o essere convertita in formato digitale.

\section{Principali funzioni}
Il progetto preesistente ha le stesse funzioni del nuovo programma richieste, con alcune eccezioni per quanto riguarda la fotocamera. Quella utilizzata precedentemente presentava alcune funzioni che la nuova fotocamera non mette a disposizione. Ad ogni modo si descriver\`a il progetto cercando di evidenziare le funzionalit\`a che necessitano di essere abbandonate a causa della diversit\`a dei due strumenti.\\
L'interfaccia non presenta alcuna divisione tra i controlli dei due strumenti e si possono quindi controllare simultaneamente senza alcuna distinzione. È chiaro che lo strumento che ha priorità in fase di inizializzazione è il monocromatore, in quanto composto da elementi fisici che devono essere riportati con movimenti meccanici ad una posizione di dafault; solo una volta che le lenti e la griglia all'interno dello strumento si trovano nella posizione iniziale è possibile cominciare ad utilizzare il programma.

\subsection{Monocromatore}
I comandi presenti per controllare il monocromatore sono gli stessi richiesti nel nuovo progetto: selezione del grating (e rispettive calibrazioni per correggere eventuali errori), impostazione della lunghezza d'onda e slit di entrata. Sono inoltre presenti dei led che mostrano eventuali errori: un errore generico in fase di inizializzazione, lunghezza d'onda inserita errata e superamento dei limiti dei valori consentiti.

\subsection{Fotocamera}
Per quanto riguarda la fotocamera si distingue fra acquisizione singola o continua ed è possibile inserire tempo di esposizione e ritardo di acquisizione dell'immagine. Si può inoltre scegliere un valore specifico di binning, fino a 1/16 per il binning verticale e fino a 1/8 per il binning orizzontale. Viene anche segnalato un'eventuale caso di saturazione con un calcolo successivo alla foto.

\subsection{Altre opzioni}
È possibile effettuare delle operazioni non collegate direttamente ai due strumenti. Oltre a visualizzare l'immagine così come è stata presa, è anche possibile visualizzare lo spettro corrispondente in seguito a determinati calcoli. Su tale spettro si possono richiedere alcune informazioni quali l'integrale su un certo intervallo della lunghezza d'onda, il numero di picchi rilevati al di sopra di una certa soglia; viene inoltre mostrato, senza bisogno di chiederlo, il valore del picco più alto alla lunghezza d'onda corrispondente e la FWHM (Full Width at Half Maximum), che corrisponde alla differenza fra i valori assunti dalla variabile indipendente lunghezza d'onda quando la variabile dipendente y (?) è pari a metà del suo valore massimo.
È disponibile un comando per l'acquisizione del background (legato però alla fotocamera): infatti nel caso in cui lo spettro venga generato in un ambiente (visivamente) ``rumoroso'' si può successivamente utilizzare il suddetto dato per sottrarlo a immagini successive, in modo da renderle il più chiare possibile.

\section {Codice del progetto preesistente}
Si analizza nella seguenti sezioni il codice del progetto preesistente, al fine di giustificare la scelta di progettazione fatta successivamente. La descrizione del codice si articola fra analisi del front panel e del block diagram, che sono i due ambienti di programmazione principale del linguaggio \emph{LabVIEW}.

\subsection{Front Panel}
\textbf{------- inserire foto front panel -------}
Il front panel è diviso in blocchi ideali che non dividono veramente il codice ma danno all'utente tale impressione.\\
In alto si trova una tab control che mostra, a seconda della selezione, l'immagine acquisita oppure lo spettro; per visualizzare lo spettro dopo aver l'immagine e viceversa è necessario riacquisire i dati. Nella sezione dedicata allo spettro sono presenti tre indicatori che mostrano il valore del picco massimo alla lunghezza d'onda corrispondente e il valore della FWHM in mm.\\
La prima fascia di pannelli è composta da tre parti. La prima contiene un bottone booleano con cui si richiede il numero di picchi oltre una certa soglia, i cui valori vengono visualizzati in indicatori di array. La seconda permette di inserire gli estremi di un intervallo di lunghezza d'onda e di richiederne, attraverso un bottone booleano, l'integrale. La terza parte non è delimitata da un vero e proprio pannello ma contiene due indicatori di versione (main e boot) del monocromatore, un indicatore della acquisizioni fino a quel momento e il bottone booleano di uscita.\\
La seconda fascia è divisa in due parti. La prima, dedicata alla fotocamera, contiene un bottone booleano per acquisizione singola e uno per quella continua, due controlli e rispettivi indicatori per ritardo ed esposizione, due quadranti per impostare il binning verticale e orizzontale, un led di indicazione di un'eventuale saturazione e un controllo per inserire il numero di pixel su cui fare la media per generare lo spettro. La seconda parte contiene invece controlli e indicatori per il monocromatore: bottone booleano per il grating (1200 o 2400) e rispettivi controlli per inserire la calibrazione in entrambi i casi, un controllo per inserire la lunghezza d'onda e uno per la slit di entrata, due indicatori per mostrarne i valori reali, e tre led che indicano se il monocromatore è stato correttamente inizializzato o se sono presenti errori generici, lunghezza d'onda non valida e superamento dei limiti consentiti.\\
La terza fascia è divisa in quattro parti. Nella prima c'è la possibilità di salvare i dati con un file path predefinito (calcolato secondo le impostazioni del programma) oppure da inserire manualmente. Nella seconda parte è possibile selezionare il modo di acquisizione della foto, via software (impostazione di dafault), trigger esterno al fronte di salita o trigger esterno al fronte di discesa; con un bottone booleano si modifica la modalità e un led indica se il programma è in attesa di un trigger. La quarte parte indica la temperatura del CCD e della board (?) della camera.

\subsection{Block Diagram}
\textbf{------- inserire foto block diagram -------}
Il block diagram è composto di una macro flat sequence (sequenza che forza il flusso dei dati in una determinata sequenza scelta dal programmatore) divisa in tre blocchi: il primo che delimita l'inizializzazione degli strumenti, il secondo contiene il codice principale del programma, e il terzo chiude in modo corretto la fotocamera.\\


\section{Considerazioni sul progetto a livello di programmazione}

In pratica i difetti dai.